from django.shortcuts import render
import numpy as np
from keras.applications.mobilenet import MobileNet, preprocess_input, decode_predictions
from keras.preprocessing.image import img_to_array
from PIL import Image
from PIL import Image
#import urllib2 as urllib
import io
import requests
#import urllib
import os
from io import BytesIO
from keras.models import load_model
def home(request):
    return render(request,'home.html')

def image_process(path):
        img = Image.open(requests.get(path, stream=True).raw)

        img = img.resize((224, 224))

        img1 = img_to_array(img)

        img1 = np.expand_dims(img1, axis=0)

        img1 = preprocess_input(img1)

        return img1

def predictor(img):
        model = load_model("small_last4(last).h5")
        pred = model.predict(img)
        print(pred)
        p = np.argmax(pred)
        pr = np.max(pred)/np.sum(pred)
        pr = pr*100
        if pr<50:
            return "Other"

        arr = ["Glass","Metal","Paper","Plastic"]

        return arr[p]

def image(request):
    img_url = request.GET.get('url_name','none')
    #print("yooo  "+img_url+"yoooo")
    #img_url = 'data:image/jpeg;base64,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'
    img =  image_process(img_url)
    word = predictor(img)
    return render(request,'image.html',{'img':img_url,'label':word})